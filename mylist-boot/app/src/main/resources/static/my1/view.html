<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>연봉을 높이자</title>
</head>
<body>
  <h1>수정수정수정</h1>
<form >
날짜*:<input id="x-date"type="date" readonly ><br>
수업주제*:<input id="x-subject"type="text" ><br>
이해도:<select id="x-underStanding">
  <option value="">선택</option>
  <option value="상">상</option>
  <option value="중">중</option>
  <option value="하">하</option>
</select><br>
대면/비대면: <select id="x-face">
  <option value="">선택</option>
  <option value="대면">대면</option>
  <option value="비대면">비대면</option>
</select><br>
별표(*)는 반드시 입력 하셔야 합니다.<br>
<button id="x-update-btn"type="button" >변경</button>
<button id="x-delete-btn"type="button" >삭제</button>
<button id="x-cancel-btn"type="button" >취소</button>
</form>
</body>

<script type="text/javascript">

// 1) URL에서 쿼리스트링(query string)을 추출한다.
// 예)http://localhost:8080/my1/view.html?date=2021-12-08
  var arr = location.href.split("?");
  console.log(arr); // ['http://localhost:8080/my1/view.html', 'date=2021-12-02']

  if (arr.length == 1){
    alert("요청 형식이 바르지 않습니다. ")
    throw "URL 형식 오류!"
  }
  var qs = arr[1];
  console.log(qs); //date=2021-12-02
  // 2) 퀴리스트링에서 email값 추출
  //
  // var date = null;
  // var values = qs.split("&")
  // for (var value of values){ // &은 없는데 왜 values 대신 qs를 쓰면 오류가 나올까?
  //   if (value.startsWith("date=")){
  //    date = value.split("=")[1];
  //     break;
  //   }
  // }
var params = new URLSearchParams(qs);
var date = params.get("date");


  if (date == null) {
    alert("날짜 값이 없습니다. ");
    throw "파라미터 오류!"
  }
  console.log(date); //2021-12-02

  var xDate = document.querySelector("#x-date")
  var xSubject = document.querySelector("#x-subject")
  var xUnderStanding = document.querySelector("#x-underStanding")
  var xFace = document.querySelector("#x-face")

  // 3) 연락처 상세 정보를 화면에 출력한다.
  fetch(`/my1/get?date=${date}`)
    .then(function(response) {
      return response.text();
    })
    .then(function(contact) {
      console.log(contact); //2021-12-02,ㅇㅇㅇ,상,대면
      var values = contact.split(",");
      // 4) 연락처 상세 정보를 화면에 출력한다.
      xDate.value = values[0];
      xSubject.value = values[1];
      xUnderStanding.value = values[2];
      xFace.value = values[3];
    })



  document.querySelector("#x-update-btn").onclick = function() {

    if (xDate.value == "" || xSubject == ""){
      window.alert("필수 입력 항목을 입력하세요");
      return;
    }

    fetch(`/my1/update?date=${xDate.value}&subject=${xSubject.value}&underStanding=${xUnderStanding.value}&face=${xFace.value}`)
    .then(function(response) {
      return response.text()
    })
    .then(function(text) {
      console.log(text);
      location.href = "index.html"
    })
  };
  document.querySelector("#x-delete-btn").onclick = function() {
    fetch(`/contact/delete?date=${date}`)
      .then(function(response) {
        return response.json();
      })
      .then(function(result) {
        console.log(result);
        location.href = "index.html";
      });

  }
 document.querySelector("#x-cancel-btn").onclick = function() {
 window.location.href = "index.html"
 }
</script>

</html>
